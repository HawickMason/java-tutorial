# 监视目录的变化

您是否曾发现使用ide或其他编辑器编辑文件，会出现一个对话框，通知您该文件已经更改，需要重新加载？（notepad++ 就完美还原这个场景），或则像像NetBeans IDE一样，应用程序只是安静的更新文件，而不通知您。

要实现此功能，称为文件**更改通知**，程序必须能够检测文件系统上相关目录发生的情况。一种方法是**轮询文件系统**寻找变更，但是这种方法效率低下。它不会扩展到具有数百个打开的文件或目录来监视的应用程序。

该`java.nio.file`软件包提供了一个名为`Watch Service API`的文件更改通知API。该API使您能够使用监视服务注册目录（或目录）。注册时，告诉服务您感兴趣的事件类型：**文件创建**，**文件删除**或**文件修改**。当服务检测到感兴趣的事件时，它被转发到注册的进程。注册过程有一个线程（或一个线程池），用于监视其注册的任何事件。当事件进入时，根据需要进行处理。

本节包括以下内容：

* Watch服务概述
* 试试看
* 创建观察服务并注册活动
* 处理事件
* 检索文件名
* 何时使用和不使用此API

## Watch服务概述
该`WatchServiceAPI`是相当低的水平，使您可以自定义。您可以按原样使用，也可以选择在此机制之上创建高级API，以使其适合您的特定需求。

以下是实施Watch服务所需的基本步骤：

1. WatchService为文件系统创建一个“观察者”。
2. 对于您要监视的每个目录，请将其注册给观察者。注册目录时，指定要通知的事件的类型。您收到`WatchKey`您注册的每个目录的一个实例。
3. 实现无限循环等待传入事件。当事件发生时，key被发出信号并放置在观察者的队列中。
4. 从观察者的队列中检索key 。您可以从key 获取文件名。
5. 检索key 的每个待处理事件（可能有多个事件），并根据需要进行处理。
6. 重置key ，并恢复等待事件。
7. 关闭服务：当线程退出或关闭时（通过调用其closed方法），watch服务退出。